(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{470:function(t,s,n){"use strict";n.r(s);var a=n(2),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"项目情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目情况"}},[t._v("#")]),t._v(" 项目情况")]),t._v(" "),s("p",[t._v("项目基于 VUE，使用 VUE-cli 3 创建，然后执行")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("vue add electron-builder\n")])])]),s("p",[t._v("添加 Electron-Builder")]),t._v(" "),s("h2",{attrs:{id:"问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[t._v("#")]),t._v(" 问题描述")]),t._v(" "),s("p",[t._v("在执行")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("npm run electron:build\n")])])]),s("p",[t._v("的时候，会打包失败，错误日志如下（敏感信息已打码），")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Error: C:\\Users\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("我的windows账户名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\AppData\\Local\\electron-builder\\Cache\\nsis\\nsis-3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\\Bin\\makensis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exe exited with code ERR_ELECTRON_BUILDER_CANNOT_EXECUTE\nOutput:\n\nOutput:\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_ID=com.electron.{我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_GUID=c587bd21-8cd2-5b34-93a3-ad3ca404cd06"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNINSTALL_APP_KEY=c587bd21-8cd2-5b34-93a3-ad3ca404cd06"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PRODUCT_NAME={我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PRODUCT_FILENAME={我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_FILENAME={我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_DESCRIPTION="')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"VERSION=0.1.0"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PROJECT_DIR=D:\\Test\\{我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BUILD_RESOURCES_DIR=D:\\Test\\{我的项目名称}\\build"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_PACKAGE_NAME={我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_64=D:\\Test\\{我的项目名称}\\dist_electron\\{我的项目名称}-0.1.0-x64.nsis.7z"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_64_NAME={我的项目名称}-0.1.0-x64.nsis.7z"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_64_HASH=8EE6D7EDADFDD46851BD6424FB67BD9E98CD6B405D6B319E3DD582FF7DED068210BD65C46FD93EB98D0DBD012D447DA4E0AD599DFC6A2BD62993EACC16BD3F64"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"APP_INSTALLER_STORE_FILE={我的项目名称}-updater\\installer.exe"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"COMPRESSION_METHOD=7z"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ONE_CLICK"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RUN_AFTER_FINISH"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHORTCUT_NAME={我的项目名称}"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNINSTALL_DISPLAY_NAME={我的项目名称} 0.1.0"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ESTIMATED_SIZE=159797"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"COMPRESS=auto"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BUILD_UNINSTALLER"')]),t._v("\nCommand line defined: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNINSTALLER_OUT_FILE=D:\\Test\\{我的项目名称}\\dist_electron\\__uninstaller-nsis-{我的项目名称}.exe"')]),t._v("\nProcessing config: C:\\Users\\��\\AppData\\Local\\electron-builder\\Cache\\nsis\\nsis-3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\\nsisconf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nsh\nProcessing script file: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ACP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nError output:\n\nError output:\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("include: could not find: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C:\\Users\\{我的windows账户名}\\AppData\\Local\\Temp\\t-bDWVX6\\0-messages.nsh"')]),t._v("\nError in script "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" on line 75 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v(" aborting creation "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("process")]),t._v("\n\n    at ChildProcess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childProcess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("once"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D:\\Test\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("我的项目名称"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\node_modules\\builder-util\\src\\util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ts:243:14"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onceWrapper "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js:273:13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at ChildProcess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("emit "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js:182:13"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at maybeClose "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("internal/child_process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js:978:16"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Process")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ChildProcess"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_handle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onexit "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("internal/child_process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js:265:5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  exitCode: 1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  alreadyLogged: false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  code: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ERR_ELECTRON_BUILDER_CANNOT_EXECUTE'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 1\nnpm ERR! "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("我的项目名称"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 electron:build: `vue-"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cli")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("service electron:build`\nnpm ERR! "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Exit")]),t._v(" status 1\nnpm ERR!\n\nnpm ERR! Failed at the "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("我的项目名称"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0 electron:build script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\nnpm ERR! This is probably not a problem with npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" There is likely additional logging output above"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     C:\\Users\\"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("我的windows账户名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\\AppData\\Roaming\\npm-cache\\_logs\\2020-12-16T05_39_35_234Z-debug"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log\n")])])]),s("p",[t._v("从错误日志上来看，产生此错误的原因是，nsis 插件找不到了。但是我打开对应目录，很明显，nsis 是存在的。然后我发现一个关键点，那就是路径中出现了乱码")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("Processing config: C:\\Users\\��\\AppData\\Local\\electron-builder\\Cache\\nsis\\nsis-3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("1\\nsisconf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nsh\n")])])]),s("p",[t._v("显然，是因为我的 windows 账户名是中文，但是在打包过程中，有某些插件不能正确识别中文导致的。\n问题的根源已经找到了。怎么办呢。别人出现这个问题，都是项目名称或者路径里出现了中文，改掉就是了，我这个是 AppData 文件夹路径出现中文，怎么改？")]),t._v(" "),s("p",[t._v("处理办法我想到了以下几个")]),t._v(" "),s("p",[t._v("经过一系列的 baidu，google，bing。终于，在一篇博文中发现了解决方案。")]),t._v(" "),s("p",[t._v("打开 node_module/app-builder-lib/out/targets/nsis/NsisTarget.js 文件，在 executeMakensis 方法中加入我们所需的参数。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeMakensis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("defines"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commands"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("warningsAsErrors "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-WX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-INPUTCHARSET"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("defines"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" defines"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("-D")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("-D")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("经测试，问题完美解决")])])}),[],!1,null,null,null);s.default=e.exports}}]);